---
id: com.github.jeromerobert.pdfarranger
runtime: org.gnome.Platform
runtime-version: '3.38'
sdk: org.gnome.Sdk
command: pdfarranger

finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --filesystem=home

modules:
  - shared-modules/intltool/intltool-0.51.json
  - shared-modules/openjpeg/openjpeg.json # dependency of poppler

  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_UTILS=OFF
      - -DENABLE_CPP=OFF
      - -DENABLE_QT5=OFF
    sources:
      - url: https://poppler.freedesktop.org/poppler-0.90.1.tar.xz
        sha256: 984d82e72e91418d280885298c8bdc855a2fd92665fd52a1345b27235e0c71c4
        type: archive

  - name: python-distutils-extra
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://launchpad.net/python-distutils-extra/trunk/2.39/+download/python-distutils-extra-2.39.tar.gz
        sha256: 723f24f4d65fc8d99b33a002fbbb3771d4cc9d664c97085bf37f3997ae8063af
        type: archive

  - name: pikepdf
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} lxml-*.whl pikepdf-*.whl Pillow-*.whl img2pdf-*.tar.gz
    sources:
      - url: https://files.pythonhosted.org/packages/38/50/0d588e236645220521a583b15093d645bd2586761bcbc4c3242697694ade/pikepdf-1.19.3-cp38-cp38-manylinux2010_x86_64.whl
        sha256: 304553140d85ab789994cbe218813e5e7b60d7c033c3fbe504d7b82f811f0c96
        type: file
      - url: https://files.pythonhosted.org/packages/b7/51/fe28c128985b6a38fbcd091110e1e53846bf900cf143b04a071f2c1c81e7/lxml-4.5.2-cp38-cp38-manylinux1_x86_64.whl
        sha256: aa8eba3db3d8761db161003e2d0586608092e217151d7458206e243be5a43843
        type: file
      - url: https://files.pythonhosted.org/packages/aa/12/a5e5e1b9bcd6c16eb4833069e6d586dc2b8ebbd3141a369cb1bdb9e4cc04/Pillow-7.2.0-cp38-cp38-manylinux1_x86_64.whl
        sha256: d08b23fdb388c0715990cbc06866db554e1822c4bdcf6d4166cf30ac82df8c41
        type: file
      - url: https://files.pythonhosted.org/packages/65/12/6ee1a77614df6decefd88f781cf95b73acf93f0cc9eb03bd5042d116b85d/img2pdf-0.3.6.tar.gz
        sha256: 8cd5509a60b75f4442b897bad3d593e25ebd314105f3034a8f17def396a4a0fb
        type: file

  - name: pdfarranger
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} .
    sources:
      - url: https://github.com/jeromerobert/pdfarranger
        tag: 1.6.2
        commit: 81a49272b3166a136d4d7e3ecb5022bf62186bc1
        type: git

cleanup:
  - /include
  - /lib/pkgconfig
  - /app/lib/openjpeg-2.3
  - /app/bin/opj_*
